<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>RelatÃ³rio Ordem de ProduÃ§Ã£o</title>

<style>
@page { size: A4; margin: 12mm; }

body {
    font-family: Arial, sans-serif;
    font-size: 10px;
    margin: 0;
}

.botao-container {
    text-align: right;
    margin-bottom: 10px;
}

.botao {
    padding: 6px 12px;
    font-size: 11px;
    cursor: pointer;
    border: 1px solid #000;
    background-color: #f2f2f2;
}

.titulo {
    text-align: center;
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 15px;
}
</style>
</head>

<body>

<div class="botao-container">
    <button class="botao" onclick="salvarEFechar()">Salvar e Fechar</button>
</div>

<div class="titulo">
    RELATÃ“RIO ORDEM DE PRODUÃ‡ÃƒO
</div>

<script>

// ðŸ”¹ forÃ§a abrir como popup
if (window.opener == null) {
    window.open(window.location.href, "Relatorio",
        "width=1100,height=850,toolbar=no,menubar=no,scrollbars=yes,resizable=yes");
    window.close();
}

// ðŸ”¹ bloqueia fechamento acidental
window.onbeforeunload = function () {
    return "VocÃª precisa salvar o relatÃ³rio antes de fechar.";
};

// ðŸ”¹ funÃ§Ã£o salvar + fechar
function salvarEFechar() {

    const conteudo = document.documentElement.outerHTML;
    const blob = new Blob([conteudo], { type: "text/html" });
    const url = URL.createObjectURL(blob);

    const ordem = "OP";

    const a = document.createElement("a");
    a.href = url;
    a.download = "Relatorio_OP_" + ordem + ".html";
    a.click();

    URL.revokeObjectURL(url);

    // remove bloqueio
    window.onbeforeunload = null;

    // fecha popup
    window.close();
}

</script>

</body>
</html>
