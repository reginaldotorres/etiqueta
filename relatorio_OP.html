<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Relatório Ordem de Produção</title>

<style>

@page {
    size: A4;
    margin: 12mm;
}

body {
    font-family: Arial, sans-serif;
    font-size: 10px;
    margin: 0;
}

.titulo {
    text-align: center;
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 15px;
}

.box {
    border: 1px solid #000;
    padding: 8px;
    margin-bottom: 12px;
}

.flex {
    display: flex;
    justify-content: space-between;
    margin-bottom: 5px;
}

.label {
    font-weight: bold;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 8px;
}

th, td {
    border: 1px solid #000;
    padding: 3px;
    text-align: center;
}

th {
    background-color: #eaeaea;
    font-size: 9px;
}

.total {
    text-align: right;
    font-weight: bold;
    margin-top: 8px;
    font-size: 11px;
}

</style>
</head>

<body>

<div class="titulo">
    RELATÓRIO ORDEM DE PRODUÇÃO
</div>

<div class="box">
    <div class="flex">
        <div><span class="label">Ordem:</span> <span id="ordem"></span></div>
        <div><span class="label">Status:</span> <span id="status"></span></div>
        <div><span class="label">Data:</span> <span id="data"></span></div>
        <div><span class="label">Semana:</span> <span id="semana"></span></div>
    </div>

    <div class="flex">
        <div><span class="label">PA:</span> <span id="pa"></span></div>
        <div><span class="label">Código:</span> <span id="codigo"></span></div>
        <div><span class="label">Descrição:</span> <span id="descricao"></span></div>
        <div><span class="label">Lote:</span> <span id="lote"></span></div>
    </div>
</div>

<div class="box">

<div class="label">Matérias-Primas Utilizadas</div>

<table>
<thead>
<tr>
<th>Código</th>
<th>Complemento</th>
<th>Qtd Fórmula</th>
<th>Tolerância</th>
<th>Qtd Add</th>
<th>UC</th>
<th>Cód PI</th>
<th>Compl PI</th>
<th>Lote</th>
<th>Qtd PI</th>
<th>CMV</th>
<th>Custo</th>
<th>Saldo</th>
</tr>
</thead>

<tbody id="tabelaItens"></tbody>

</table>

<div class="total">
Total MP: <span id="totalmp"></span>
</div>

</div>

<script>

function getParametro(nome) {
    const params = new URLSearchParams(window.location.search);
    return params.get(nome);
}

let dadosParam = getParametro("dados");

if (dadosParam) {

    try {

        let dados = JSON.parse(dadosParam);
        let registro = dados[0];
        let cab = registro.Cabecalho;

        // ====== CABEÇALHO ======
        document.getElementById("ordem").innerText = cab.Ordem ?? "";
        document.getElementById("status").innerText = cab.Status ?? "";
        document.getElementById("data").innerText = cab.Data ?? "";
        document.getElementById("semana").innerText = cab.Semana ?? "";
        document.getElementById("pa").innerText = cab.PA ?? "";
        document.getElementById("codigo").innerText = cab.Codigo ?? "";
        document.getElementById("descricao").innerText = cab.Descricao ?? "";
        document.getElementById("lote").innerText = cab.Lote ?? "";
        document.getElementById("totalmp").innerText = cab.Total_MP ?? "";

        let tabela = document.getElementById("tabelaItens");
        tabela.innerHTML = "";

        // ====== ITENS ======
        registro.Itens.forEach(item => {

            if (item.Codigo && item.UCs) {

                item.UCs.forEach((uc, index) => {

                    let linha = `
                    <tr>
                        <td>${index === 0 ? item.Codigo ?? "" : ""}</td>
                        <td>${index === 0 ? item.Complemento ?? "" : ""}</td>
                        <td>${index === 0 ? item.QtdFormula ?? "" : ""}</td>
                        <td>${index === 0 ? item.Tolerancia ?? "" : ""}</td>

                        <td>${uc.Quantidade ?? ""}</td>
                        <td>${uc.UC ?? ""}</td>
                        <td>${uc.CodigoPI ?? ""}</td>
                        <td>${uc.Complemento ?? ""}</td>
                        <td>${uc.Lote ?? ""}</td>
                        <td>${uc.Quantidade ?? ""}</td>
                        <td>${uc.CMV ?? ""}</td>
                        <td>${uc.Custo ?? ""}</td>
                        <td>${uc.Saldo ?? ""}</td>
                    </tr>
                    `;

                    tabela.innerHTML += linha;
                });

            }
        });

    } catch (erro) {
        console.error("Erro ao ler JSON:", erro);
    }
}

</script>
</body>
</html>


</body>
</html>
